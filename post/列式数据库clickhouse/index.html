<!doctype html>
<html lang="zh-cn">
  <head>
    <title>列式数据库ClickHouse // iceymoss - 刻意练习，卷无止境</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.111.3">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="iceymoss" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.3c3c186cd62e563ad6e2f00a89dbee656ab912d1d46f856b5605dd0232521e2a.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="列式数据库ClickHouse"/>
<meta name="twitter:description" content="[toc] ClickHouse 介绍 ClickHouse是一种开源的列式数据库管理系统（DBMS），专门设计用于大规模数据分析。它以高性能和扩展性而闻名，并且被广泛应用"/>

    <meta property="og:title" content="列式数据库ClickHouse" />
<meta property="og:description" content="[toc] ClickHouse 介绍 ClickHouse是一种开源的列式数据库管理系统（DBMS），专门设计用于大规模数据分析。它以高性能和扩展性而闻名，并且被广泛应用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://iceymoss.github.io/post/%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93clickhouse/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-08-19T15:16:20+08:00" />
<meta property="article:modified_time" content="2023-08-19T15:16:20+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://iceymoss.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="iceymoss" /></a>
      <span class="app-header-title">iceymoss - 刻意练习，卷无止境</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">首页</a>
             - 
          
          <a class="app-header-menu-item" href="/archives/">归档</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">标签</a>
             - 
          
          <a class="app-header-menu-item" href="/categories/">类别</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">关于</a>
      </nav>
      <p>iceymoss&#39;s blog, Golang Python Developer Life</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">列式数据库ClickHouse</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Aug 19, 2023
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          9 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://iceymoss.github.io/tags/clickhouse/">ClickHouse</a>
              <a class="tag" href="https://iceymoss.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
              <a class="tag" href="https://iceymoss.github.io/tags/golang/">Golang</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>[toc]</p>
<h1 id="clickhouse">ClickHouse</h1>
<h2 id="介绍">介绍</h2>
<p>ClickHouse是一种开源的列式数据库管理系统（DBMS），专门设计用于大规模数据分析。它以高性能和扩展性而闻名，并且被广泛应用于各种数据分析和实时查询场景。</p>
<p>以下是ClickHouse的一些主要特点和优势：</p>
<ol>
<li>列式存储：ClickHouse使用列式存储，将数据按列进行存储，而不是按行。这种存储方式在大规模数据分析中具有优势，因为它可以压缩数据、提升查询性能、减少IO操作等。</li>
<li>高性能：ClickHouse被设计为高性能的数据分析引擎。它通过并行处理和多核优化等技术，能够快速地执行各种复杂的查询操作。ClickHouse还支持数据分区和复制，以进一步提高查询的性能和可用性。</li>
<li>扩展性：ClickHouse可以轻松地横向扩展，以处理大规模的数据集和高并发的查询请求。它支持分布式架构和自动数据分片，可以将数据和查询负载分散到多个节点上，从而实现水平扩展。</li>
<li>实时查询：尽管ClickHouse主要用于数据分析，但它也能够支持实时查询。它提供了一种称为“近似精确度”的技术，可以在轻微的精度损失下快速计算结果，从而实现快速的实时查询。</li>
<li>SQL兼容性：ClickHouse支持标准SQL查询语言，使得用户可以使用熟悉的SQL语句来查询和分析数据。同时，ClickHouse还支持其他一些高级功能和扩展，例如窗口函数、数据聚合和数据转换等。</li>
</ol>
<p>总的来说，ClickHouse是一个功能丰富的列式数据库系统，适用于大规模的数据分析和实时查询。它具有高性能、高扩展性和SQL兼容性等优势，被广泛应用于数据仓库、日志分析、实时报表等领域。</p>
<h2 id="使用场景">使用场景</h2>
<p>ClickHouse的使用场景可以包括以下几个方面：</p>
<ol>
<li>数据仓库：ClickHouse适用于构建数据仓库，用于存储和分析大规模的结构化和半结构化数据。它可以处理数十亿、甚至数万亿行的数据，支持复杂的查询和聚合操作。</li>
<li>实时分析：ClickHouse可以处理实时数据分析场景，包括实时查询、实时报表和仪表板等。它能够快速地处理大量的数据，并在几秒或几毫秒内返回查询结果。</li>
<li>日志分析：ClickHouse在处理日志分析方面表现出色。它可以处理海量的日志数据，并支持快速的搜索、过滤和聚合操作。这使得它成为实时监控和故障排查的理想选择。</li>
<li>时间序列数据分析：由于列式存储和高性能查询的支持，ClickHouse非常适用于处理大规模的时间序列数据。它可以用于监测系统、物联网设备、金融数据等领域。</li>
<li>分布式查询处理：ClickHouse支持分布式查询和数据复制，可以在多个节点之间分散查询负载，并提高查询的性能和可用性。这使得它可以应对大规模的并发查询和高吞吐量的应用场景。</li>
</ol>
<p>总的来说，ClickHouse适用于需要处理大规模数据和高并发查询的数据分析场景。它在数据仓库、实时分析、日志分析和时间序列数据分析等方面具有广泛的应用。</p>
<h2 id="存储引擎">存储引擎</h2>
<p>ClickHouse使用了自己独特的列式存储引擎，称为MergeTree存储引擎，它是为高性能分析而设计的。</p>
<p>MergeTree存储引擎基于列式存储的原则。它将表中的每一列分别存储在独立的文件中，每个文件包含该列的所有值。这种存储方式使得ClickHouse在处理大规模数据时表现卓越，因为它可以只读取和处理需要的列，节省了对其他列的读取和解析。</p>
<p>MergeTree存储引擎支持对数据进行分区和排序。数据可以按照时间范围进行分区，每个分区内的数据按照一个或多个列进行排序。这些特性使得ClickHouse在处理时间序列数据时非常高效，可以快速地查询和分析特定时间段的数据。</p>
<p>此外，MergeTree存储引擎还支持数据压缩和多级索引。数据压缩可以减少存储空间的占用，并提高磁盘IO性能。多级索引可以加速数据的查找和过滤，提高查询的效率。</p>
<p>总的来说，MergeTree存储引擎是ClickHouse的核心组件，它采用了列式存储、分区、排序、数据压缩和多级索引等技术，使得ClickHouse在处理大规模数据和高性能查询方面具有优势。</p>
<h2 id="安装docker">安装(docker)</h2>
<p>直接使用命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --name clickhouse-server -p 8123:8123 -p 9000:9000 clickhouse/clickhouse-server:22.8.14.53
</span></span></code></pre></div><p>如果需要做数据持久化:</p>
<p>以下是在使用Docker安装ClickHouse时实现持久化的步骤：</p>
<ol>
<li>创建数据目录：在主机上创建一个用于存储ClickHouse数据的目录。例如，您可以创建一个名为<code>/path/to/clickhouse/data</code>的目录。</li>
<li>运行容器时挂载数据目录：在运行ClickHouse容器时，使用<code>-v</code>参数来将主机上的数据目录挂载到容器内。运行以下命令来创建并启动ClickHouse容器，并挂载数据目录：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --name clickhouse-server <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 8123:8123 -p 9000:9000 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v /path/to/clickhouse/data:/var/lib/clickhouse <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>clickhouse/clickhouse-server:22.8.14.53
</span></span></code></pre></div><p>此命令将主机上的<code>/path/to/clickhouse/data</code>目录挂载到容器内的<code>/var/lib/clickhouse</code>目录上。这样可以确保容器内的数据持久化保存在主机上的指定位置。</p>
<ol start="3">
<li>验证持久化：等待容器启动后，可以使用以下命令验证数据是否持久化保存到了指定目录：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ls /path/to/clickhouse/data
</span></span></code></pre></div><p>如果你能看到ClickHouse数据文件和目录的列表，这意味着数据成功地持久保存在了主机上的数据目录中。</p>
<p>通过以上步骤，您已经成功地使用Docker安装并配置了持久化的ClickHouse实例。这将确保您的数据在容器重启或迁移时不会丢失。</p>
<h2 id="简单实例">简单实例</h2>
<h3 id="建表">建表</h3>
<p>当使用ClickHouse进行SQL操作时，首先需要创建一个用户信息的表。以下是一个示例的SQL语句，用于创建一个名为<code>users</code>的表，包含用户的姓名、年龄和电子邮件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> users (
</span></span><span style="display:flex;"><span>    name String,
</span></span><span style="display:flex;"><span>    age Int32,
</span></span><span style="display:flex;"><span>    email <span style="color:#66d9ef">Nullable</span>(String)
</span></span><span style="display:flex;"><span>) ENGINE <span style="color:#f92672">=</span> MergeTree()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> name;
</span></span></code></pre></div><p>在该表的创建语句中，<code>name</code>列使用<code>String</code>数据类型存储用户姓名，<code>age</code>列使用<code>Int32</code>数据类型存储用户年龄，<code>email</code>列使用<code>Nullable(String)</code>数据类型存储用户电子邮件，允许为空值。表的引擎使用了MergeTree引擎，并按<code>name</code>列进行排序。</p>
<p>完成表的创建后，我们可以使用SQL命令对<code>users</code>表进行数据操作。以下是一些常见的操作示例：</p>
<h3 id="插入数据">插入数据</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> users (name, age, email)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#ae81ff">25</span>, <span style="color:#e6db74">&#39;alice@example.com&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> users (name, age)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;Bob&#39;</span>, <span style="color:#ae81ff">30</span>);
</span></span></code></pre></div><h3 id="查询数据">查询数据</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> users;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> name, age <span style="color:#66d9ef">FROM</span> users <span style="color:#66d9ef">WHERE</span> age <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">25</span>;
</span></span></code></pre></div><h3 id="更新数据">更新数据</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> users <span style="color:#66d9ef">UPDATE</span> age <span style="color:#f92672">=</span> age <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">WHERE</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Alice&#39;</span>;
</span></span></code></pre></div><h3 id="删除数据">删除数据</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> users <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">WHERE</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Bob&#39;</span>;
</span></span></code></pre></div><h2 id="复杂表结构">复杂表结构</h2>
<h3 id="定义表结构">定义表结构</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> pcp_product_view (
</span></span><span style="display:flex;"><span>    event_id String,   <span style="color:#f92672">//</span><span style="color:#960050;background-color:#1e0010">字符串</span>
</span></span><span style="display:flex;"><span>    name String,
</span></span><span style="display:flex;"><span>    event_src String,
</span></span><span style="display:flex;"><span>    created_at DateTime, <span style="color:#f92672">//</span><span style="color:#960050;background-color:#1e0010">时间</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">data</span> Tuple (   <span style="color:#f92672">//</span><span style="color:#960050;background-color:#1e0010">元组，内嵌</span>
</span></span><span style="display:flex;"><span>        user_id Int64,   <span style="color:#f92672">//</span>int<span style="color:#960050;background-color:#1e0010">类型</span>
</span></span><span style="display:flex;"><span>        product_id String,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">domain</span> String,
</span></span><span style="display:flex;"><span>        subdomain String,
</span></span><span style="display:flex;"><span>        store_id Int64,
</span></span><span style="display:flex;"><span>        retailer_id Int64,
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    geoip Tuple (
</span></span><span style="display:flex;"><span>        ip String,
</span></span><span style="display:flex;"><span>        country String
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    device Tuple (
</span></span><span style="display:flex;"><span>        browser String,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">version</span> String,
</span></span><span style="display:flex;"><span>        os String
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    headers Tuple (
</span></span><span style="display:flex;"><span>        ev String,
</span></span><span style="display:flex;"><span>        site String,
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    retailer Tuple (
</span></span><span style="display:flex;"><span>        id Int64,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">domain</span> String,
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    client Tuple (
</span></span><span style="display:flex;"><span>        id String,
</span></span><span style="display:flex;"><span>        web_id String,
</span></span><span style="display:flex;"><span>        url String,
</span></span><span style="display:flex;"><span>        timestamp_ms Int64
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    store Tuple (
</span></span><span style="display:flex;"><span>        id Int64,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">domain</span> String,
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    extension Tuple (
</span></span><span style="display:flex;"><span>        id String,
</span></span><span style="display:flex;"><span>        session_id String,
</span></span><span style="display:flex;"><span>        serial_id Int64,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">version</span> String
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    tab Tuple (
</span></span><span style="display:flex;"><span>        id Int64,
</span></span><span style="display:flex;"><span>        session_id String,
</span></span><span style="display:flex;"><span>        serial_id Int64,
</span></span><span style="display:flex;"><span>        page_language String
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>) engine <span style="color:#f92672">=</span> MergeTree PARTITION <span style="color:#66d9ef">BY</span> toYYYYMMDD(toDateTime(created_at, <span style="color:#e6db74">&#39;America/Los_Angeles&#39;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> created_at
</span></span><span style="display:flex;"><span>        SETTINGS index_granularity <span style="color:#f92672">=</span> <span style="color:#ae81ff">8192</span>;
</span></span></code></pre></div><h3 id="添加字段">添加字段</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> pcp_product_view <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">COLUMN</span> <span style="color:#66d9ef">user</span> Tuple(id Int8) <span style="color:#66d9ef">AFTER</span> <span style="color:#66d9ef">data</span>;
</span></span></code></pre></div><h2 id="go操作ch">GO操作CH</h2>
<p>安装依赖</p>
<pre tabindex="0"><code>go get github.com/ClickHouse/clickhouse-go/v2
</code></pre><p>要使用Github上的clickhouse-go库来连接到ClickHouse，你需要做以下准备工作：</p>
<ol>
<li>在Go项目中导入clickhouse-go库：</li>
</ol>
<pre tabindex="0"><code>goCopy code
import (
    &#34;github.com/ClickHouse/clickhouse-go/v2&#34;
)
</code></pre><ol start="2">
<li>使用clickhouse-go库来建立到ClickHouse数据库的连接。你需要提供ClickHouse数据库的连接信息和凭据。以下是一个简单的示例：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 配置ClickHouse连接信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">dsn</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;tcp://localhost:9000?database=your_database&amp;username=default&amp;password=your_password&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 建立到ClickHouse的连接
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">clickhouse</span>.<span style="color:#a6e22e">OpenConnection</span>(<span style="color:#a6e22e">dsn</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 在这里可以执行ClickHouse查询和操作
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 例如：conn.ExecContext(ctx, &#34;CREATE TABLE IF NOT EXISTS example_table (id Int32, name String)&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 更多操作和查询的示例可以在clickhouse-go库的文档中找到
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>在上面的示例中，我们通过<code>clickhouse.OpenConnection(dsn)</code>建立到ClickHouse数据库的连接，并通过<code>defer conn.Close()</code>在使用完连接后关闭连接。</p>
<p>请确保将示例中的<code>your_database</code>替换为你实际的数据库名称，<code>your_password</code>替换为你实际的密码。</p>
<p>这样就可以来操作clickhouse了。</p>
<p>该包提供了以下常用方法用于数据的增删改查操作：</p>
<ol>
<li>Exec(query string, args &hellip;interface{}) error: 执行一个查询语句，无需返回结果。</li>
<li>Select(query string, args &hellip;interface{}) (<em>sql.Rows, error): 执行SELECT查询，并返回查询结果的</em>sql.Rows对象。</li>
<li>SelectRow(query string, args &hellip;interface{}) <em>sql.Row: 执行SELECT查询，并返回查询结果的</em>sql.Row对象。</li>
<li>Insert(table string, data map[string]interface{}) error: 插入数据到指定的表中，data是一个包含列名和对应值的map。</li>
<li>CopyFromReader(table string, reader io.Reader) (int, error): 从一个io.Reader读取数据，并将数据复制到指定的表中。</li>
<li>ExecContext(ctx context.Context, query string, args &hellip;interface{}) (sql.Result, error): 在指定的上下文中执行一个查询语句，无需返回结果。</li>
<li>InsertContext(ctx context.Context, table string, data map[string]interface{}) (sql.Result, error): 在指定的上下文中将数据插入到指定的表中。</li>
<li>SelectContext(ctx context.Context, query string, args &hellip;interface{}) (<em>sql.Rows, error): 在指定的上下文中执行SELECT查询，并返回查询结果的</em>sql.Rows对象。</li>
<li>SelectRowContext(ctx context.Context, query string, args &hellip;interface{}) <em>sql.Row: 在指定的上下文中执行SELECT查询，并返回查询结果的</em>sql.Row对象。</li>
<li>Begin() (*sql.Tx, error): 开始一个数据库事务。</li>
<li>WithTimeout(timeout time.Duration): 设置数据库操作的超时时间。</li>
</ol>
<p>以上是一些常用的方法，用于在Go中进行ClickHouse数据库的增删改查操作。具体的使用方法和参数可以根据实际需求进行参考。</p>
<h3 id="实例">实例</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">LogToCH</span>(<span style="color:#a6e22e">event</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">req</span> <span style="color:#a6e22e">EventRequest</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//获取到CH的连接
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">CH</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">GetClickhouseConn</span>(<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">ClickHouse</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;获取CH客户端失败:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">CH</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">eventCh</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ReqToEventCH</span>(<span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">req</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">query</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;INSERT INTO %s (event_id, name, event_src,created_at, data, user, geoip, device, headers, retailer, client, store, extension, tab) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?)&#34;</span>, <span style="color:#a6e22e">event</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//执行插入操作
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">stmt</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">CH</span>.<span style="color:#a6e22e">PrepareBatch</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">query</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;插入预操作失败：&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">eventCh</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">Append</span>(<span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;event_id&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;name&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;event_src&#34;</span>], <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(), <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;data&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;user&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;geoip&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;device&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;headers&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;retailer&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;client&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;store&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;extension&#34;</span>], <span style="color:#a6e22e">v</span>[<span style="color:#e6db74">&#34;tab&#34;</span>])
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;写入数据到CH失败：&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">stmt</span>.<span style="color:#a6e22e">Send</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;发送失败：&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ch对数据结构要求非常的严格，必须数据类型和字段完全匹配</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">ReqToEventCH</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">req</span> <span style="color:#a6e22e">EventRequest</span>) []<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{} {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">resp</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">Events</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">data</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">name</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">event001</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Data</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;转json失败&#34;</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">product</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">DataProductView</span>{}
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">b</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">product</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;解json失败&#34;</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//不同的data内部结构不同，需要判断
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">data</span> = <span style="color:#a6e22e">productView</span>(<span style="color:#a6e22e">product</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>{
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">……</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">events</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;event_id&#34;</span>:   <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">ID</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;name&#34;</span>:       <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;event_src&#34;</span>:  <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">EventSrc</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;created_at&#34;</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(),
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;data&#34;</span>:       <span style="color:#a6e22e">data</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;user&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;id&#34;</span>: int8(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">User</span>.<span style="color:#a6e22e">ID</span>),
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;geoip&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;ip&#34;</span>:      <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Geoip</span>.<span style="color:#a6e22e">Ip</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;country&#34;</span>: <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Geoip</span>.<span style="color:#a6e22e">Country</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;retailer&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;id&#34;</span>:         int64(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Retailer</span>.<span style="color:#a6e22e">ID</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;domain&#34;</span>:     <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Retailer</span>.<span style="color:#a6e22e">Domain</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;client&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;id&#34;</span>:           <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Client</span>.<span style="color:#a6e22e">ID</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;url&#34;</span>:          <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Client</span>.<span style="color:#a6e22e">URL</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;web_id&#34;</span>:       <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;timestamp_ms&#34;</span>: int64(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Client</span>.<span style="color:#a6e22e">TimestampMS</span>),
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;headers&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;ev&#34;</span>:   <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">EventHeaders</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Ev</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;site&#34;</span>: <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">EventHeaders</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Site</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;bl&#34;</span>:   <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">EventHeaders</span>.<span style="color:#a6e22e">Header</span>.<span style="color:#a6e22e">Bl</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;extension&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;id&#34;</span>:         <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Extension</span>.<span style="color:#a6e22e">ID</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;session_id&#34;</span>: <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Extension</span>.<span style="color:#a6e22e">SessionID</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;serial_id&#34;</span>:  int64(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Extension</span>.<span style="color:#a6e22e">SerialId</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;version&#34;</span>:    <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Extension</span>.<span style="color:#a6e22e">Version</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;device&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;browser&#34;</span>: <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Device</span>.<span style="color:#a6e22e">Browser</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;version&#34;</span>: <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Device</span>.<span style="color:#a6e22e">Version</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;os&#34;</span>:      <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Device</span>.<span style="color:#a6e22e">Os</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;store&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;id&#34;</span>:         int64(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Store</span>.<span style="color:#a6e22e">ID</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;domain&#34;</span>:     <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Store</span>.<span style="color:#a6e22e">Domain</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;subdomain&#34;</span>:  <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Store</span>.<span style="color:#a6e22e">Subdomain</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;tab&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;id&#34;</span>:            int64(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Tab</span>.<span style="color:#a6e22e">ID</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;session_id&#34;</span>:    <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Tab</span>.<span style="color:#a6e22e">SessionID</span>,
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">resp</span> = append(<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">events</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">resp</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">productView</span>(<span style="color:#a6e22e">d</span> <span style="color:#a6e22e">DataProductView</span>) <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{} {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;user_id&#34;</span>:         int64(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">UserId</span>),
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;product_id&#34;</span>:      <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">ProductId</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;domain&#34;</span>:          <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">Domain</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;subdomain&#34;</span>:       <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">Subdomain</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;store_id&#34;</span>:        int64(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">StoreId</span>),
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;retailer_id&#34;</span>:     int64(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">RetailerId</span>),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="总结">总结</h2>
<p>对应clickhouse的简单学习和使用我们了解这里就差不多了，当然还有更多的关于性能优化，索引等等这里就不介绍，对于使用CH其实都是使用SQL已经进行操作，所以SQL是很重要的，好吧本文也没什么值得学习的，就简单的介绍和使用了CH希望能加深你对它的了解。</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
